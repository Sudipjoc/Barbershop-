<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="BarberShop & Hair Salon HTML Template">
  <meta name="author" content="">
  <title>Barber Shop || Login</title>
  <link rel="shortcut icon" type="image/x-icon" href="">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="css/elegant-font-icons.css">
  <link rel="stylesheet" href="css/elegant-line-icons.css">
  <link rel="stylesheet" href="css/themify-icons.css">
  <link rel="stylesheet" href="css/barber-icons.css">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/animate.min.css">
  <link rel="stylesheet" href="css/venobox/venobox.css">
  <link rel="stylesheet" href="css/nice-select.css">
  <link rel="stylesheet" href="css/owl.carousel.css">
  <link rel="stylesheet" href="css/slicknav.min.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/responsive.css">
  
  <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>

  <style>
    /* Login Page */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80vh;
      background-color: #f8f9fa;
    }

    .login-box {
      background: #fff;
      padding: 30px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      border-radius: 10px;
      text-align: center;
      width: 350px;
    }

    .login-box h2 {
      margin-bottom: 20px;
      font-weight: bold;
    }

    .input-group {
      text-align: left;
      margin-bottom: 15px;
    }

    .input-group label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }

    .input-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .login-btn {
      width: 100%;
      padding: 10px;
      background: #b01b1b;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }

    .login-btn:hover {
      background: #900d0d;
    }

    p {
      margin-top: 10px;
    }

    p a {
      color: rgb(33, 33, 168);
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>

<body>

  <!-- Preloader -->
  <div id='preloader'>
    <div class='loader'>
      <img src="" width="80" alt="">
    </div>
  </div>

  <!-- Header -->
  <header id="header" class="header-section">
    <div class="container">
      <nav class="navbar">
        <a href="#" class="navbar-brand" style="color: white">BarberShop</a>
        <div class="d-flex menu-wrap align-items-center">
          <div id="mainmenu" class="mainmenu">
            <ul class="nav">
              <li><a data-scroll class="nav-link active" href="index.html">Home</a></li>
              <li><a href="about-us.html">About</a></li>
              <li><a href="services.html">Services</a></li>
              <li><a href="#">Pages</a>
                <ul>
                  <li><a href="login.html">Appointment</a></li>
                  <li><a href="team.html">Our Team</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="header-btn">
            <a href="Signup.html" class="menu-btn">SignUp</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- Login Section -->
  <section class="login-container">
    <div class="login-box">
      <h2>Login</h2>
      <form id="loginForm">
        <div class="input-group">
          <label>Email</label>
          <input type="email" name="email" placeholder="Enter your email" required>
        </div>
        <div class="input-group">
          <label>Password</label>
          <input type="password" name="password" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="login-btn" id="loginBtn">Login</button>
      </form>
      <p>Don't have an account? <a href="Signup.html">Sign Up</a></p>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer_section">
    <div class="container">
      <div class="row">
        <div class="col-md-6 xs-padding">
          <div class="copyright">
            &copy; <script>document.write(new Date().getFullYear())</script> Barber Shop
          </div>
        </div>
        <div class="col-md-6 xs-padding">
          <ul class="footer_social">
            <li><a href="#">Orders</a></li>
            <li><a href="#">Terms</a></li>
            <li><a href="#">Report Problem</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer>

  <a data-scroll href="#header" id="scroll-to-top"><i class="arrow_up"></i></a>

  <!-- Vendor Scripts -->
  <script src="js/vendor/jquery-1.12.4.min.js"></script>
  <script src="js/vendor/bootstrap.min.js"></script>
  <script src="js/vendor/imagesloaded.pkgd.min.js"></script>
  <script src="js/vendor/owl.carousel.min.js"></script>
  <script src="js/vendor/jquery.isotope.v3.0.2.js"></script>
  <script src="js/vendor/smooth-scroll.min.js"></script>
  <script src="js/vendor/venobox.min.js"></script>
  <script src="js/vendor/jquery.ajaxchimp.min.js"></script>
  <script src="js/vendor/jquery.slicknav.min.js"></script>
  <script src="js/vendor/jquery.nice-select.min.js"></script>
  <script src="js/vendor/jquery.mb.YTPlayer.min.js"></script>
  <script src="js/vendor/wow.min.js"></script>
  <script src="js/contact.js"></script>
  <script src="js/appointment.js"></script>
  <script src="js/main.js"></script>

  <!-- Login Script -->
  <script>
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const email = document.querySelector("input[name='email']").value.trim();
      const password = document.querySelector("input[name='password']").value;
      const loginBtn = document.getElementById("loginBtn");
  
      loginBtn.disabled = true;
      loginBtn.innerText = "Logging in...";
  
      try {
        const response = await fetch("http://localhost:5000/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
  
        const data = await response.json();
  
        if (!response.ok) {
          throw new Error(data.message || "Invalid email or password");
        }
  
        if (data.token && data.user) {
          // Save token and user info
          localStorage.setItem("token", data.token);
          localStorage.setItem("role", data.user.role);
          localStorage.setItem("userId", data.user._id); // ✅ fixed from .id to ._id
  
          if (data.user.role === "barber") {
            localStorage.setItem("barberId", data.user._id); // ✅ fixed
            localStorage.setItem("barberName", data.user.name || ""); // fallback
          }
  
          // Clear form
          document.getElementById("loginForm").reset();
  
          // Redirect based on role
          switch (data.user.role) {
            case "admin":
              window.location.href = "admin.html";
              break;
            case "barber":
              window.location.href = "barberdashboard.html";
              break;
            default:
              window.location.href = "index2.html";
              break;
          }
        } else {
          alert("Invalid Credentials");
        }
      } catch (error) {
        console.error("Login Error:", error);
        alert(error.message || "Login failed. Please try again.");
      } finally {
        loginBtn.disabled = false;
        loginBtn.innerText = "Login";
      }
    });
  </script>
  
</body>

</html>
